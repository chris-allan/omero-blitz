<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# $Id$
#
# Copyright 2007 Glencoe Software, Inc. All rights reserved.
# Use is subject to license terms supplied in LICENSE.txt
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Written by:  Josh Moore, josh at glencoesoftware.com
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->

<!-- Stub configuration for OMERO.blitz.test -->

<beans>

 <bean id="mockDeclarer" class="ome.services.blitz.test.mock.MockDeclarer">
   <constructor-arg>
     <map>
       <entry key="ome.api.IAdmin" value="ome.api.local.LocalAdmin"/>
       <entry key="ome.api.IConfig" value=""/>
       <entry key="ome.api.IDelete" value=""/>
       <entry key="ome.api.ILdap" value=""/>
       <entry key="ome.api.IPixels" value=""/>
       <entry key="ome.api.IPojos" value=""/>
       <entry key="ome.api.IQuery" value="ome.api.local.LocalQuery"/>
       <entry key="ome.api.IRenderingSettings" value=""/>
       <entry key="ome.api.IRepositoryInfo" value=""/>
       <entry key="ome.api.ISession" value=""/>
       <entry key="ome.api.IShare" value=""/>
       <entry key="ome.api.ITypes" value=""/>
       <entry key="ome.api.IUpdate" value="ome.api.local.LocalUpdate"/>
       <!-- Stateful -->
       <entry key="ome.api.JobHandle" value=""/>
       <entry key="ome.api.RawFileStore" value=""/>
       <entry key="ome.api.RawPixelsStore" value=""/>
       <entry key="omeis.providers.re.RenderingEngine" value=""/>
       <entry key="ome.api.Search" value=""/>
       <entry key="ome.api.ThumbnailStore" value=""/>
       <!-- Blitz only
       <entry key="ome.api.Gateway" value=""/>
       <entry key="ome.api.IScript" value=""/>
       -->
     </map>
   </constructor-arg>
 </bean>

 <bean id="securitySystem" factory-bean="securityMock" factory-method="proxy"/>
 <bean id="methodSecurity" factory-bean="methodMock" factory-method="proxy"/>
  <bean id="executor"       factory-bean="executorMock" factory-method="proxy"/>
 <!-- Here it is necessary to specify the HardWiredInterceptors instances
 even if they are *not* specified in Spring -->
 <bean id="securityWiring" class="ome.security.basic.BasicSecurityWiring">
   <property name="principalHolder" ref="principalHolder"/>
   <property name="methodSecurity"  ref="methodSecurity"/>
 </bean>

 <bean id="securityMock" class="org.jmock.Mock">
   <constructor-arg value="ome.security.SecuritySystem" type="java.lang.Class"/>
 </bean>

 <bean id="methodMock" class="org.jmock.Mock">
   <constructor-arg value="ome.security.MethodSecurity" type="java.lang.Class"/>
 </bean>

  <bean id="executorMock" class="ome.services.blitz.test.fixtures.ExecutorMockFactory"/>

  <bean id="cacheManager" class="ome.tools.spring.ShutdownSafeEhcacheManagerFactoryBean"/>

  <bean id="principalHolder" class="ome.security.basic.CurrentDetails"/>

  <!-- ome.services.sessions.SessionManager with swappable implementation -->

  <bean id="sessionsMock" class="org.jmock.Mock">
      <constructor-arg value="ome.services.sessions.SessionManager" type="java.lang.Class"/>
  </bean>

  <bean id="mockedSessionManager" factory-bean="sessionsMock" factory-method="proxy"/>

  <bean id="swappableSessionManagerSource"
      class="org.springframework.aop.target.HotSwappableTargetSource">
      <constructor-arg ref="mockedSessionManager"/>
  </bean>

  <bean id="sessionManager" class="org.springframework.aop.framework.ProxyFactoryBean">
      <property name="targetSource" ref="swappableSessionManagerSource"/>
  </bean>
  

  <!-- SessionManagerI configuration with a swappable adapter-->

  <bean id="adapterMock" class="org.jmock.Mock">
      <constructor-arg value="Ice.ObjectAdapter" type="java.lang.Class"/>
  </bean>

  <bean id="mockedAdapter" factory-bean="adapterMock" factory-method="proxy"/>

  <bean id="swappableAdapterSource"
      class="org.springframework.aop.target.HotSwappableTargetSource">
      <constructor-arg ref="mockedAdapter"/>
  </bean>

  <bean id="adapter" class="org.springframework.aop.framework.ProxyFactoryBean">
      <property name="targetSource" ref="swappableAdapterSource"/>
  </bean>
  
  <bean id="BlitzManager" class="ome.services.blitz.fire.SessionManagerI">
      <constructor-arg ref="securitySystem"/>
      <constructor-arg ref="sessionManager"/>
      <constructor-arg ref="executor"/>
      <constructor-arg ref="adapter"/>
  </bean>

</beans>
