#
#   $Id$
#
#   Copyright 2007 Glencoe Software, Inc. All rights reserved.
#   Use is subject to license terms supplied in LICENSE.txt
#
#

AUTOMAKE_OPTIONS = foreign subdir-objects

SLICE_DIR=@SLICE_DIR@
SLICE_OME=../../resources/slice
SLICE_GEN=../../target/generated/resources
SLICE_INCLUDES=-I$(SLICE_DIR) -I$(SLICE_OME) -I$(SLICE_GEN)

CPP_SRC=.
CPP_GEN=generated2
CPP_MODEL=$(CPP_GEN)/OMERO/Model.h

INCLUDES=-I$(CPP_GEN) -I$(CPP_SRC) -Igenerated
LIBS=-lstdc++ -lIce -lIceUtil -lSlice -lGlacier2

default:
	echo "Nothing"

slice: 
	mkdir -p $(CPP_GEN)/OMERO/Model && \
	@SLICE2CPP@ $(SLICE_INCLUDES) --include-dir=OMERO       --output-dir=$(CPP_GEN)/OMERO/      $(SLICE_GEN)/OMERO/*.ice      $(SLICE_OME)/OMERO/*.ice && \
	@SLICE2CPP@ $(SLICE_INCLUDES) --include-dir=OMERO/Model --output-dir=$(CPP_GEN)/OMERO/Model $(SLICE_GEN)/OMERO/Model/*.ice $(SLICE_OME)/OMERO/Model/*.ice

model: slice
	(test -e $(CPP_MODEL) && rm $(CPP_MODEL)); \
	find $(CPP_GEN)/OMERO/Model/ -name "*.h" -exec grep class {} /dev/null \; | grep IceProxy | grep    omero::model::IObject | cut -d: -f1 | sort | uniq >> $(CPP_MODEL) && \
	find $(CPP_GEN)/OMERO/Model/ -name "*.h" -exec grep class {} /dev/null \; | grep IceProxy | grep -v omero::model::IObject | cut -d: -f1 | sort | uniq >> $(CPP_MODEL) && \
	perl -i -pe 's/^generated2\//#include </' $(CPP_MODEL) &&\
	perl -i -pe 's/$$/>/' $(CPP_MODEL)

lib_LTLIBRARIES     	= libOMERO_common.la libOMERO_client.la 
libOMERO_common_la_SOURCES = ./OMERO/ClientErrors.cpp ./OMERO/Model/DetailsI.cpp ./OMERO/Model/PermissionsI.cpp ./generated/OMERO/Model/FilterI.cpp ./generated/OMERO/Model/ExternalInfoI.cpp ./generated/OMERO/Model/XYZTtoXYTLinkI.cpp ./generated/OMERO/Model/PlaneSlicingContextI.cpp ./generated/OMERO/Model/CellMinorAxisLengthI.cpp ./generated/OMERO/Model/EventI.cpp ./generated/OMERO/Model/ImageNucleasCountI.cpp ./generated/OMERO/Model/FormatI.cpp ./generated/OMERO/Model/XYZCTI.cpp ./generated/OMERO/Model/DatasetImageLinkI.cpp ./generated/OMERO/Model/XYTtoXYLinkI.cpp ./generated/OMERO/Model/ShapeAreaI.cpp ./generated/OMERO/Model/JobStatusI.cpp ./generated/OMERO/Model/ArcTypeI.cpp ./generated/OMERO/Model/URoiI.cpp ./generated/OMERO/Model/NucleusPositionI.cpp ./generated/OMERO/Model/ExcitationFilterI.cpp ./generated/OMERO/Model/QuantumDefI.cpp ./generated/OMERO/Model/ThumbnailI.cpp ./generated/OMERO/Model/ImportJobI.cpp ./generated/OMERO/Model/ImageCellCountI.cpp ./generated/OMERO/Model/XYZI.cpp ./generated/OMERO/Model/DummyStatisticsI.cpp ./generated/OMERO/Model/CellEccentricityI.cpp ./generated/OMERO/Model/ContrastMethodI.cpp ./generated/OMERO/Model/IlluminationI.cpp ./generated/OMERO/Model/PlaneInfoI.cpp ./generated/OMERO/Model/DichroicI.cpp ./generated/OMERO/Model/ExperimentI.cpp ./generated/OMERO/Model/ProjectDatasetLinkI.cpp ./generated/OMERO/Model/NucleusEccentricityI.cpp ./generated/OMERO/Model/ReverseIntensityContextI.cpp ./generated/OMERO/Model/MicroscopeTypeI.cpp ./generated/OMERO/Model/XYZCI.cpp ./generated/OMERO/Model/LaserMediumI.cpp ./generated/OMERO/Model/JobI.cpp ./generated/OMERO/Model/PulseI.cpp ./generated/OMERO/Model/CategoryGroupCategoryLinkI.cpp ./generated/OMERO/Model/DatasetAnnotationI.cpp ./generated/OMERO/Model/RoiMapI.cpp ./generated/OMERO/Model/Roi5DI.cpp ./generated/OMERO/Model/TransmittanceRangeI.cpp ./generated/OMERO/Model/JobOriginalFileLinkI.cpp ./generated/OMERO/Model/ExperimenterI.cpp ./generated/OMERO/Model/FilamentTypeI.cpp ./generated/OMERO/Model/CellAreaI.cpp ./generated/OMERO/Model/XYZCTtoXYZTLinkI.cpp ./generated/OMERO/Model/ImageI.cpp ./generated/OMERO/Model/XYCI.cpp ./generated/OMERO/Model/StageLabelI.cpp ./generated/OMERO/Model/NucleusMinorAxisLengthI.cpp ./generated/OMERO/Model/NucleusSolidityI.cpp ./generated/OMERO/Model/USquareI.cpp ./generated/OMERO/Model/FilterSetI.cpp ./generated/OMERO/Model/DetectorSettingsI.cpp ./generated/OMERO/Model/ObjectiveSettingsI.cpp ./generated/OMERO/Model/ProjectI.cpp ./generated/OMERO/Model/EventLogI.cpp ./generated/OMERO/Model/XYCTI.cpp ./generated/OMERO/Model/GroupExperimenterMapI.cpp ./generated/OMERO/Model/FrequencyMultiplicationI.cpp ./generated/OMERO/Model/ProjectAnnotationI.cpp ./generated/OMERO/Model/CategoryGroupI.cpp ./generated/OMERO/Model/ChannelBindingI.cpp ./generated/OMERO/Model/PixelsTypeI.cpp ./generated/OMERO/Model/EmissionFilterI.cpp ./generated/OMERO/Model/SquareI.cpp ./generated/OMERO/Model/XYZCTtoXYCTLinkI.cpp ./generated/OMERO/Model/XYZTI.cpp ./generated/OMERO/Model/PixelsDimensionsI.cpp ./generated/OMERO/Model/StatsInfoI.cpp ./generated/OMERO/Model/RoiExtentI.cpp ./generated/OMERO/Model/RenderingModelI.cpp ./generated/OMERO/Model/CellMajorAxisLengthI.cpp ./generated/OMERO/Model/XYZtoXYLinkI.cpp ./generated/OMERO/Model/XYCTtoXYTLinkI.cpp ./generated/OMERO/Model/ContrastStretchingContextI.cpp ./generated/OMERO/Model/XYZCTtoXYZCLinkI.cpp ./generated/OMERO/Model/LogicalChannelI.cpp ./generated/OMERO/Model/OverlayI.cpp ./generated/OMERO/Model/PixelsOriginalFileMapI.cpp ./generated/OMERO/Model/AcquisitionModeI.cpp ./generated/OMERO/Model/CellPerimeterI.cpp ./generated/OMERO/Model/ImageAnnotationI.cpp ./generated/OMERO/Model/OverlayTypeI.cpp ./generated/OMERO/Model/CategoryImageLinkI.cpp ./generated/OMERO/Model/CustomizedFilterSetI.cpp ./generated/OMERO/Model/ChannelI.cpp ./generated/OMERO/Model/LaserTypeI.cpp ./generated/OMERO/Model/CellPositionI.cpp ./generated/OMERO/Model/NucleusExtentI.cpp ./generated/OMERO/Model/DetectorTypeI.cpp ./generated/OMERO/Model/BoundingBoxI.cpp ./generated/OMERO/Model/ColorI.cpp ./generated/OMERO/Model/MicroscopeI.cpp ./generated/OMERO/Model/XYTI.cpp ./generated/OMERO/Model/ArcI.cpp ./generated/OMERO/Model/LightSettingsI.cpp ./generated/OMERO/Model/LightSourceI.cpp ./generated/OMERO/Model/XYZCtoXYZLinkI.cpp ./generated/OMERO/Model/FamilyI.cpp ./generated/OMERO/Model/CategoryI.cpp ./generated/OMERO/Model/IrisDiaphragmI.cpp ./generated/OMERO/Model/ExperimentTypeI.cpp ./generated/OMERO/Model/PhotometricInterpretationI.cpp ./generated/OMERO/Model/NucleusAreaI.cpp ./generated/OMERO/Model/OriginalFileI.cpp ./generated/OMERO/Model/PixelsI.cpp ./generated/OMERO/Model/XYCtoXYLinkI.cpp ./generated/OMERO/Model/SpecificationI.cpp ./generated/OMERO/Model/DatasetI.cpp ./generated/OMERO/Model/ExperimenterGroupI.cpp ./generated/OMERO/Model/FilterTypeI.cpp ./generated/OMERO/Model/BinningI.cpp ./generated/OMERO/Model/CoatingI.cpp ./generated/OMERO/Model/MediumI.cpp ./generated/OMERO/Model/CellExtentI.cpp ./generated/OMERO/Model/XYCTtoXYCLinkI.cpp ./generated/OMERO/Model/LaserI.cpp ./generated/OMERO/Model/OTFI.cpp ./generated/OMERO/Model/UShapeI.cpp ./generated/OMERO/Model/EventTypeI.cpp ./generated/OMERO/Model/ImagingEnvironmentI.cpp ./generated/OMERO/Model/USliceI.cpp ./generated/OMERO/Model/NucleusMajorAxisLengthI.cpp ./generated/OMERO/Model/RenderingDefI.cpp ./generated/OMERO/Model/ImmersionI.cpp ./generated/OMERO/Model/AberrationCorrectionI.cpp ./generated/OMERO/Model/MetadataI.cpp ./generated/OMERO/Model/InstrumentI.cpp ./generated/OMERO/Model/FilamentI.cpp ./generated/OMERO/Model/ObjectiveI.cpp ./generated/OMERO/Model/NucleusPerimeterI.cpp ./generated/OMERO/Model/RegionTypeI.cpp ./generated/OMERO/Model/CodomainMapContextI.cpp ./generated/OMERO/Model/RegionI.cpp ./generated/OMERO/Model/CellSolidityI.cpp ./generated/OMERO/Model/DetectorI.cpp ./generated/OMERO/Model/XYZTtoXYZLinkI.cpp ./generated/OMERO/Model/XYI.cpp ./generated/OMERO/Model/LinkI.cpp ./generated/OMERO/Model/RoiSetI.cpp ./generated/OMERO/Model/DimensionOrderI.cpp ./generated/OMERO/Model/XYZCtoXYCLinkI.cpp ./generated/OMERO/ObjectFactoryRegistrar.cpp ./generated2/OMERO/Model/AberrationCorrection.cpp ./generated2/OMERO/Model/AcquisitionMode.cpp ./generated2/OMERO/Model/Arc.cpp ./generated2/OMERO/Model/ArcType.cpp ./generated2/OMERO/Model/Binning.cpp ./generated2/OMERO/Model/BoundingBox.cpp ./generated2/OMERO/Model/CategoryGroupCategoryLink.cpp ./generated2/OMERO/Model/CategoryGroup.cpp ./generated2/OMERO/Model/Category.cpp ./generated2/OMERO/Model/CategoryImageLink.cpp ./generated2/OMERO/Model/CellArea.cpp ./generated2/OMERO/Model/CellEccentricity.cpp ./generated2/OMERO/Model/CellExtent.cpp ./generated2/OMERO/Model/CellMajorAxisLength.cpp ./generated2/OMERO/Model/CellMinorAxisLength.cpp ./generated2/OMERO/Model/CellPerimeter.cpp ./generated2/OMERO/Model/CellPosition.cpp ./generated2/OMERO/Model/CellSolidity.cpp ./generated2/OMERO/Model/ChannelBinding.cpp ./generated2/OMERO/Model/Channel.cpp ./generated2/OMERO/Model/Coating.cpp ./generated2/OMERO/Model/CodomainMapContext.cpp ./generated2/OMERO/Model/Color.cpp ./generated2/OMERO/Model/ContrastMethod.cpp ./generated2/OMERO/Model/ContrastStretchingContext.cpp ./generated2/OMERO/Model/CustomizedFilterSet.cpp ./generated2/OMERO/Model/DatasetAnnotation.cpp ./generated2/OMERO/Model/Dataset.cpp ./generated2/OMERO/Model/DatasetImageLink.cpp ./generated2/OMERO/Model/Detector.cpp ./generated2/OMERO/Model/DetectorSettings.cpp ./generated2/OMERO/Model/DetectorType.cpp ./generated2/OMERO/Model/Dichroic.cpp ./generated2/OMERO/Model/DimensionOrder.cpp ./generated2/OMERO/Model/DummyStatistics.cpp ./generated2/OMERO/Model/EmissionFilter.cpp ./generated2/OMERO/Model/Event.cpp ./generated2/OMERO/Model/EventLog.cpp ./generated2/OMERO/Model/EventType.cpp ./generated2/OMERO/Model/ExcitationFilter.cpp ./generated2/OMERO/Model/ExperimenterGroup.cpp ./generated2/OMERO/Model/Experimenter.cpp ./generated2/OMERO/Model/Experiment.cpp ./generated2/OMERO/Model/ExperimentType.cpp ./generated2/OMERO/Model/ExternalInfo.cpp ./generated2/OMERO/Model/Family.cpp ./generated2/OMERO/Model/Filament.cpp ./generated2/OMERO/Model/FilamentType.cpp ./generated2/OMERO/Model/Filter.cpp ./generated2/OMERO/Model/FilterSet.cpp ./generated2/OMERO/Model/FilterType.cpp ./generated2/OMERO/Model/Format.cpp ./generated2/OMERO/Model/FrequencyMultiplication.cpp ./generated2/OMERO/Model/GroupExperimenterMap.cpp ./generated2/OMERO/Model/Illumination.cpp ./generated2/OMERO/Model/ImageAnnotation.cpp ./generated2/OMERO/Model/ImageCellCount.cpp ./generated2/OMERO/Model/Image.cpp ./generated2/OMERO/Model/ImageNucleasCount.cpp ./generated2/OMERO/Model/ImagingEnvironment.cpp ./generated2/OMERO/Model/Immersion.cpp ./generated2/OMERO/Model/ImportJob.cpp ./generated2/OMERO/Model/Instrument.cpp ./generated2/OMERO/Model/IrisDiaphragm.cpp ./generated2/OMERO/Model/Job.cpp ./generated2/OMERO/Model/JobOriginalFileLink.cpp ./generated2/OMERO/Model/JobStatus.cpp ./generated2/OMERO/Model/Laser.cpp ./generated2/OMERO/Model/LaserMedium.cpp ./generated2/OMERO/Model/LaserType.cpp ./generated2/OMERO/Model/LightSettings.cpp ./generated2/OMERO/Model/LightSource.cpp ./generated2/OMERO/Model/Link.cpp ./generated2/OMERO/Model/LogicalChannel.cpp ./generated2/OMERO/Model/Medium.cpp ./generated2/OMERO/Model/Metadata.cpp ./generated2/OMERO/Model/Microscope.cpp ./generated2/OMERO/Model/MicroscopeType.cpp ./generated2/OMERO/Model/NucleusArea.cpp ./generated2/OMERO/Model/NucleusEccentricity.cpp ./generated2/OMERO/Model/NucleusExtent.cpp ./generated2/OMERO/Model/NucleusMajorAxisLength.cpp ./generated2/OMERO/Model/NucleusMinorAxisLength.cpp ./generated2/OMERO/Model/NucleusPerimeter.cpp ./generated2/OMERO/Model/NucleusPosition.cpp ./generated2/OMERO/Model/NucleusSolidity.cpp ./generated2/OMERO/Model/Objective.cpp ./generated2/OMERO/Model/ObjectiveSettings.cpp ./generated2/OMERO/Model/OriginalFile.cpp ./generated2/OMERO/Model/OTF.cpp ./generated2/OMERO/Model/Overlay.cpp ./generated2/OMERO/Model/OverlayType.cpp ./generated2/OMERO/Model/PhotometricInterpretation.cpp ./generated2/OMERO/Model/PixelsDimensions.cpp ./generated2/OMERO/Model/Pixels.cpp ./generated2/OMERO/Model/PixelsOriginalFileMap.cpp ./generated2/OMERO/Model/PixelsType.cpp ./generated2/OMERO/Model/PlaneInfo.cpp ./generated2/OMERO/Model/PlaneSlicingContext.cpp ./generated2/OMERO/Model/ProjectAnnotation.cpp ./generated2/OMERO/Model/ProjectDatasetLink.cpp ./generated2/OMERO/Model/Project.cpp ./generated2/OMERO/Model/Pulse.cpp ./generated2/OMERO/Model/QuantumDef.cpp ./generated2/OMERO/Model/Region.cpp ./generated2/OMERO/Model/RegionType.cpp ./generated2/OMERO/Model/RenderingDef.cpp ./generated2/OMERO/Model/RenderingModel.cpp ./generated2/OMERO/Model/ReverseIntensityContext.cpp ./generated2/OMERO/Model/Roi5D.cpp ./generated2/OMERO/Model/RoiExtent.cpp ./generated2/OMERO/Model/RoiMap.cpp ./generated2/OMERO/Model/RoiSet.cpp ./generated2/OMERO/Model/ShapeArea.cpp ./generated2/OMERO/Model/Specification.cpp ./generated2/OMERO/Model/Square.cpp ./generated2/OMERO/Model/StageLabel.cpp ./generated2/OMERO/Model/StatsInfo.cpp ./generated2/OMERO/Model/Thumbnail.cpp ./generated2/OMERO/Model/TransmittanceRange.cpp ./generated2/OMERO/Model/URoi.cpp ./generated2/OMERO/Model/UShape.cpp ./generated2/OMERO/Model/USlice.cpp ./generated2/OMERO/Model/USquare.cpp ./generated2/OMERO/Model/XYC.cpp ./generated2/OMERO/Model/XYCT.cpp ./generated2/OMERO/Model/XYCtoXYLink.cpp ./generated2/OMERO/Model/XYCTtoXYCLink.cpp ./generated2/OMERO/Model/XYCTtoXYTLink.cpp ./generated2/OMERO/Model/XY.cpp ./generated2/OMERO/Model/XYT.cpp ./generated2/OMERO/Model/XYTtoXYLink.cpp ./generated2/OMERO/Model/XYZC.cpp ./generated2/OMERO/Model/XYZCT.cpp ./generated2/OMERO/Model/XYZCtoXYCLink.cpp ./generated2/OMERO/Model/XYZCtoXYZLink.cpp ./generated2/OMERO/Model/XYZCTtoXYCTLink.cpp ./generated2/OMERO/Model/XYZCTtoXYZCLink.cpp ./generated2/OMERO/Model/XYZCTtoXYZTLink.cpp ./generated2/OMERO/Model/XYZ.cpp ./generated2/OMERO/Model/XYZT.cpp ./generated2/OMERO/Model/XYZtoXYLink.cpp ./generated2/OMERO/Model/XYZTtoXYTLink.cpp ./generated2/OMERO/Model/XYZTtoXYZLink.cpp ./generated2/OMERO/Model/Details.cpp ./generated2/OMERO/Model/Permissions.cpp ./generated2/OMERO/fwd.cpp ./generated2/OMERO/API.cpp ./generated2/OMERO/Constants.cpp ./generated2/OMERO/Error.cpp ./generated2/OMERO/IObject.cpp ./generated2/OMERO/ROMIO.cpp ./generated2/OMERO/RTypes.cpp ./generated2/OMERO/System.cpp
#libOMERO_common_a_LDFLAGS = -no-undefined -version-info 0:0:0

libOMERO_client_la_SOURCES= ./OMERO/client.cpp ./OMERO/CTypes.cpp
libOMERO_client_la_LIBADD = libOMERO_common.la
#libOMERO_client_a_LDFLAGS= -no-undefined -version-info 0:0:0

clean-local:
	find $(CPP_GEN) -name "*.cpp" -exec rm {} \;
	find $(CPP_GEN) -name "*.h" -exec rm {} \;
