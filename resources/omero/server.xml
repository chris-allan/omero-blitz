<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# 
# $Id: services.xml 1167 2006-12-15 10:39:34Z jmoore $
# 
# Copyright 2006 University of Dundee. All rights reserved.
# Use is subject to license terms supplied in LICENSE.txt
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Written by:  Josh Moore <josh.moore@gmx.de>
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->

<!-- Configuration for ICE services. -->

<beans>	
    
  <bean id="Ice.Communicator" class="ome.services.icy.config.IceCommunicatorFactoryBean">
    <property name="properties">
      <props>
        <prop key="OMEROObjectAdapter.Endpoints">tcp -p 9999</prop>
      </props>
    </property>
    <property name="adapters" value="OMEROObjectAdapter"/>
    <property name="logger">
      <bean class="ome.services.icy.util.CommonsLoggingAdapter">
        <constructor-arg>
          <bean class="org.springframework.beans.factory.config.CommonsLogFactoryBean">
            <property name="logName" value="IceRuntime"/>
          </bean>
        </constructor-arg>
      </bean>
    </property>
  </bean>

  <bean id="OMEROObjectAdapter" class="ome.services.icy.config.IceObjectAdapterFactoryBean">
    <property name="servants">
      <map>
        <entry key="Verifier" value-ref="Verifier"/>
        <entry key="Manager" value-ref="Manager"/>
      </map>
    </property>
  </bean>
  
  <bean id="Manager" class="ome.services.icy.fire.SessionManagerI">
    <constructor-arg ref="securitySystem"/>
  </bean>
  
  <bean id="Verifier" class="ome.services.icy.fire.PermissionsVerifierI">
    <constructor-arg ref="internal:ome.api.IAdmin"/>
  </bean>

  <bean id="Session" class="ome.services.icy.impl.ServiceFactoryI" singleton="false">
    <description>Prototype for sessions. Used by Manager</description>
    <constructor-arg ref="ServantCache"/>
  </bean>

  <bean id="ServantCache" class="org.springframework.cache.ehcache.EhCacheFactoryBean">
    <property name="cacheManager" ref="CacheManager"/>
    <property name="overflowToDisk" value="false"/>
    <property name="maxElementsInMemory" value="100"/>
    <property name="timeToLive" value="3600"/>
    <property name="timeToIdle" value="900"/>
    <!-- property name="cacheEntryFactory">
      <bean class="ome.services.icy.lookup.ContextCacheEntryFactory"/>
    </property-->
  </bean>
  
  <bean id="CacheManager" class="ome.services.icy.util.ShutdownSafeEhcacheManagerFactoryBean"/>
  
</beans>
