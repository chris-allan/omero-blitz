<?xml version="1.0" encoding="UTF-8"?>

<!--
#
# Copyright (C) 2015 University of Dundee & Open Microscopy Environment.
# All rights reserved.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#
-->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                           http://www.springframework.org/schema/util
                           http://www.springframework.org/schema/util/spring-util-2.0.xsd">

    <util:list id="chownTargets" value-type="java.lang.String">

        <!-- acquisition -->
        <value>Instrument</value>

        <!-- annotations -->
        <value>Annotation</value>
        <value>IAnnotationLink</value>

        <!-- containers -->
        <value>Dataset</value>
        <value>DatasetImageLink</value>
        <value>Project</value>
        <value>ProjectDatasetLink</value>

        <!-- core -->
        <value>Image</value>
        <value>OriginalFile</value>

        <!-- display -->
        <value>RenderingDef</value>
        <value>Thumbnail</value>

        <!-- experiment -->
        <value>Experiment</value>

        <!-- fs -->
        <value>Fileset</value>

        <!-- internal -->
        <value>Link</value>

        <!-- jobs -->
        <value>Job</value>
        <value>JobOriginalFileLink</value>

        <!-- roi -->
        <value>Roi</value>

        <!-- screen -->
        <value>Plate</value>
        <value>Reagent</value>
        <value>Screen</value>
        <value>ScreenPlateLink</value>
        <value>WellReagentLink</value>

    </util:list>

    <util:list id="chownRules" value-type="ome.services.graphs.GraphPolicyRule">

        <!-- see blitz-graph-rules.xml for rule syntax -->

        <bean parent="graphPolicyRule" p:matches="F:Fileset[!I].images = [I], F.images = [!I]" p:error="may not split {F}"/>
        <bean parent="graphPolicyRule" p:matches="Image[I].instrument = IN:Instrument, Image[!I].instrument = IN"
                                       p:error="may not split images that share {IN}"/>
        <bean parent="graphPolicyRule" p:matches="FileAnnotation[I].file = OF:OriginalFile, FileAnnotation[!I].file = OF"
                                       p:error="may not split file annotations that share {OF}"/>
        <bean parent="graphPolicyRule" p:matches="WS:WellSample[!I].image = I:[I]" p:error="may give {I} only via {WS}"/>
        <bean parent="graphPolicyRule" p:matches="G:IGlobal[E]" p:changes="G:[O]"/>
        <bean parent="graphPolicyRule" p:matches="[I] =? X:!ILink[E]{o}/o" p:changes="X:[I]"/>
        <bean parent="graphPolicyRule" p:matches="[I] =?/o X:!ILink[E]{o}" p:changes="X:[I]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!IO].parent =/!o [!O]" p:changes="L:[O]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!IO].child =/!o [!O]" p:changes="L:[O]"/>
        <bean parent="graphPolicyRule" p:matches="POFM:PixelsOriginalFileMap[!IO].parent = [E]/!d, POFM.child = Pixels[I]"
                                       p:changes="POFM:[O]"/>
        <bean parent="graphPolicyRule" p:matches="POFM:PixelsOriginalFileMap.parent = [I], POFM.child = P:Pixels[E]{r}"
                                       p:changes="P:{a}"/>
        <bean parent="graphPolicyRule" p:matches="POFM:PixelsOriginalFileMap.parent = OF:[E]{o}/o, POFM.child = Pixels[I]"
                                       p:changes="OF:[I]"/>
        <bean parent="graphPolicyRule" p:matches="POFM:PixelsOriginalFileMap.parent = OF:[E]{o}/d, POFM.child = Pixels[I]"
                                       p:changes="OF:[O]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!IO].parent = [I], L.child = C:!Job[E]/!d" p:changes="L:[O]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!O].parent = [I], L.child = C:[E]{o}/o" p:changes="C:[I]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink.parent = [I], L.child = C:[E]{o}" p:changes="C:[O]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!O].parent = [I], L.child = C:Job[E]{o}" p:changes="C:[I]"/>
        <bean parent="graphPolicyRule" p:matches="[I] == X:[E]{o}" p:changes="X:[I]"/>
        <bean parent="graphPolicyRule" p:matches="F:Fileset[E]{r}.images = Image[E]{i}" p:changes="F:{a}"/>
        <bean parent="graphPolicyRule" p:matches="I:Image[E]{!a}.rois = [I]" p:changes="I:{a}"/>
        <bean parent="graphPolicyRule" p:matches="I:Image[E]{!a}.stageLabel = [I]" p:changes="I:{a}"/>
        <bean parent="graphPolicyRule" p:matches="Image[I].wellSamples = WS:[E]" p:changes="WS:[O]"/>
        <bean parent="graphPolicyRule" p:matches="P:Pixels[E]{!a}.channels = [I]" p:changes="P:{a}"/>
        <bean parent="graphPolicyRule" p:matches="P:Pixels[E]{!a}.settings = [I]" p:changes="P:{a}"/>
        <bean parent="graphPolicyRule" p:matches="P:Pixels[E]{!a}.relatedTo = [I]" p:changes="P:{a}"/>
        <bean parent="graphPolicyRule" p:matches="Pixels[I].relatedTo = P:[E]{!a}" p:changes="P:{a}"/>
        <bean parent="graphPolicyRule" p:matches="PlateAcquisition[I].plate = C:[E]{!a}" p:changes="C:{a}"/>
        <bean parent="graphPolicyRule" p:matches="Well[I].plate = C:[E]{!a}" p:changes="C:{a}"/>
        <bean parent="graphPolicyRule" p:matches="WellSample[I].plateAcquisition = C:[E]{!a}" p:changes="C:{a}"/>
        <bean parent="graphPolicyRule" p:matches="WellSample[I].well = C:[E]{!a}" p:changes="C:{a}"/>
        <bean parent="graphPolicyRule" p:matches="WRL:WellReagentLink.parent = [E], WRL.child = R:Reagent[E]{!a}"
                                       p:changes="R:{a}"/>
        <bean parent="graphPolicyRule" p:matches="Screen[E].reagents = R:Reagent[E]{!a}" p:changes="R:{a}"/>
        <bean parent="graphPolicyRule" p:matches="R:Roi[!O].image =/!o [I]" p:changes="R:[O]"/>
        <bean parent="graphPolicyRule" p:matches="RD:RenderingDef[!O].pixels =/!o [I]" p:changes="RD:[O]"/>
        <bean parent="graphPolicyRule" p:matches="T:Thumbnail[!O].pixels =/!o [I]" p:changes="T:[O]"/>
        <bean parent="graphPolicyRule" p:matches="X:!ILink[E]/o == [I]" p:changes="X:[I]"/>
        <bean parent="graphPolicyRule" p:matches="X:!ILink[E]/!o == [I]" p:changes="X:[O]"/>
        <bean parent="graphPolicyRule" p:matches="!ILink[E]{r} = X:[E]{i}" p:changes="X:{r}"/>
        <bean parent="graphPolicyRule" p:matches="!ILink[I] = X:[E]{i}" p:changes="X:{r}"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!O]" p:changes="L:[-]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!I].parent = [I], L.child = [I]" p:changes="L:[I]/n"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[E].parent = [E], L.child = [I]" p:changes="L:[O]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!O].parent = [I], L.child = C:[E]{i}" p:changes="C:{r}"/>
        <bean parent="graphPolicyRule" p:matches="POFM:PixelsOriginalFileMap.parent = OF:[E]{i}, POFM.child = Pixels[I]"
                                       p:changes="OF:{r}"/>
        <bean parent="graphPolicyRule" p:matches="DS:DetectorSettings[E]{i}.detector = [E]{r}" p:changes="DS:{r}"/>
        <bean parent="graphPolicyRule" p:matches="LS:LightSettings[E]{i}.lightSource = [E]{r}" p:changes="LS:{r}"/>
        <bean parent="graphPolicyRule" p:matches="OS:ObjectiveSettings[E]{i}.objective = [E]{r}" p:changes="OS:{r}"/>
        <bean parent="graphPolicyRule" p:matches="X:[E]{ia} == [I]" p:changes="X:[O]"/>
        <bean parent="graphPolicyRule" p:matches="Image[I].pixels = P:[E]" p:changes="P:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Fileset[I] = I:Image[E].fileset" p:changes="I:[I]"/>
        <bean parent="graphPolicyRule" p:matches="F:Fileset[E]{i}.images = Image[I]" p:changes="F:{r}"/>
        <bean parent="graphPolicyRule" p:matches="F:Fileset[E]{o}.images = Image[I]" p:changes="F:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Fileset[I] = E:FilesetEntry[E].fileset" p:changes="E:[I]"/>
        <bean parent="graphPolicyRule" p:matches="E:FilesetEntry[E]{r}" p:changes="E:[E]{o}"/>
        <bean parent="graphPolicyRule" p:matches="Pixels[I].channels = C:Channel[E]" p:changes="C:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Pixels[I].settings =/o RD:RenderingDef[E]" p:changes="RD:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Pixels[I].thumbnails =/o T:Thumbnail[E]" p:changes="T:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Pixels[I].planeInfo = PI:PlaneInfo[E]" p:changes="PI:[I]"/>
        <bean parent="graphPolicyRule" p:matches="CB:ChannelBinding[!I].renderingDef = RD:[I]" p:changes="CB:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Plate[I].plateAcquisitions = PA:PlateAcquisition[E]" p:changes="PA:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Plate[I].wells = W:Well[E]" p:changes="W:[I]"/>
        <bean parent="graphPolicyRule" p:matches="PlateAcquisition[I].wellSample = WS:WellSample[E]" p:changes="WS:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Well[I].wellSamples = WS:WellSample[E]" p:changes="WS:[I]"/>
        <bean parent="graphPolicyRule" p:matches="FA:FileAnnotation[E].file = [I]" p:changes="FA:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Roi[I].shapes = S:Shape[E]" p:changes="S:[I]"/>
        <bean parent="graphPolicyRule" p:matches="Instrument[I].filter = F:Filter[E]" p:changes="F:[I]"/>
        <bean parent="graphPolicyRule" p:matches="POFM:PixelsOriginalFileMap.parent = OF:[E]{r}, POFM.child = Pixels[E]/o"
                                       p:changes="OF:{a}"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!O].child = C:!Job[E]{r}/!d" p:changes="C:{a}"/>
        <bean parent="graphPolicyRule" p:matches="A:FileAnnotation[E]{r}/!o" p:changes="A:{a}"/>
        <bean parent="graphPolicyRule" p:matches="A:TagAnnotation[E]{r}/!o" p:changes="A:{a}"/>
        <bean parent="graphPolicyRule" p:matches="A:TermAnnotation[E]{r}/!o" p:changes="A:{a}"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[!O].parent = [E], L.child = C:!Pixels[E]{r}" p:changes="C:{a}"/>
        <bean parent="graphPolicyRule" p:matches="!ILink[E]{ia} = X:!ILink[E]{r}" p:changes="X:{a}"/>
        <bean parent="graphPolicyRule" p:matches="X:[E]{r} == [E]{a}" p:changes="X:{a}"/>
        <bean parent="graphPolicyRule" p:matches="[I].instrument == I:Instrument[E]{r}" p:changes="I:{a}"/>
        <bean parent="graphPolicyRule" p:matches="C:Channel[E]{r}.pixels = Pixels[E]{i}" p:changes="C:{a}"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[E].parent = [I], L.child = [E]{a}" p:changes="L:[O]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[E].parent = [E], L.child = [I]" p:changes="L:[O]"/>
        <bean parent="graphPolicyRule" p:matches="L:ILink[E]{a}.parent = [I]" p:changes="L:[O]"/>
    </util:list>

</beans>
