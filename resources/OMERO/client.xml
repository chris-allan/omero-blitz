<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# $Id$
#
# Copyright 2007 Glencoe Software, Inc. All rights reserved.
# Use is subject to license terms supplied in LICENSE.txt
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->

<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Written by:  Josh Moore, josh at glencoesoftware.com
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->

<!--

	Configuration for ICE clients.

-->

<beans>

  <!-- property placeholder post-processor; copied from ome/client/spring.xml -->
	<bean id="placeholderConfig"
              class="org.springframework.beans.factory.config.PreferencesPlaceholderConfigurer">
		<property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_FALLBACK"/>
		<property name="ignoreResourceNotFound" value="true"/>
		<property name="localOverride" value="true"/>
		<property name="properties" ref="properties"/>
		<property name="locations">
		<list>
			<value>classpath:omero.properties</value>
 			<value>classpath:hibernate.properties</value>
 			<value>classpath:jndi.properties</value>
 			<value>classpath:local.properties</value>
		</list>
		</property>
	</bean>

  <bean id="Ice.Communicator" class="ome.services.icy.config.IceCommunicatorFactoryBean">
    <property name="properties">
      <props>
        <prop key="IceServiceFactory_conn">default -p 10000</prop>
        <prop key="Ice.Default.Router">OMEROGlacier2/router:tcp -p 9998 -h 127.0.0.1</prop>
        <prop key="Ice.ACM.Client">0</prop>
        <prop key="Ice.MonitorConnections">60</prop>
        <prop key="Ice.RetryIntervals">0 100 200</prop>
        <prop key="Ice.Warn.Connections">1</prop>
        <prop key="Ice.Trace.Retry">2</prop>
        <prop key="Ice.ImplicitContext">Shared</prop>
      </props>
    </property>
    <property name="defaultContext">
      <map>
        <entry>
          <key><ref bean="USERNAME"/></key>
          <value>${omero.user}</value>
        </entry>
        <entry>
          <key><ref bean="PASSWORD"/></key>
          <value>${omero.pass}</value>
        </entry>
        <entry>
          <key><ref bean="GROUP"/></key>
          <value>${omero.group}</value>
        </entry>
        <entry>
          <key><ref bean="EVENT"/></key>
          <value>${omero.event}</value>
        </entry>
      </map>
    </property>
    <property name="logger">
      <bean class="ome.services.icy.util.CommonsLoggingAdapter">
        <constructor-arg>
          <bean class="org.springframework.beans.factory.config.CommonsLogFactoryBean">
            <property name="logName" value="IceRuntime"/>
          </bean>
        </constructor-arg>
      </bean>
    </property>
  </bean>

</beans>
